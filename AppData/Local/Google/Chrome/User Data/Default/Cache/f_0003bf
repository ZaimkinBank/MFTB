!function s(r,a,h){function l(e,t){if(!a[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var n=a[e]={exports:{}};r[e][0].call(n.exports,function(t){return l(r[e][1][t]||t)},n,n.exports,s,r,a,h)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<h.length;t++)l(h[t]);return l}({1:[function(t,e,i){"use strict";var o=t("./../../../common/js/dom"),n="adlk.aud@",s=function(t,e){this._logger=t,this._config=e,this._aud={},this._inited=!1,this._frame=null,this._ready=!1,this._onReady=null};s.prototype.init=function(t){if(!this._inited){o.receive(window,function(t){var e=t.data;"string"==typeof e&&e.substr(0,n.length)==n&&(e=e.substr(n.length),this._logger.dump("AUD: Got data: "+e),this._aud=JSON.parse(e)||{},this._ready||(this._ready=!0,this._readyTimer&&(clearTimeout(this._readyTimer),this._readyTimer=null),this._notifyReady()))}.bind(this));try{this._frame=o.createFrame(this._config.cdn+this._config.cds),t.appendChild(this._frame)}catch(t){}this._inited=!0}},s.prototype.count=function(t){t&&(this._aud[t]=(this._aud[t]||0)+1,this._frame&&o.post(this._frame.contentWindow,"adlk.req@"+t))},s.prototype.allow=function(t,e){return!e||(this._aud[t]||0)<e},s.prototype.ready=function(t,e){this._ready?t():(this._onReady||(this._onReady=[]),this._onReady.push(t),e&&(this._readyTimer=setTimeout(function(){this._notifyReady()}.bind(this),e)))},s.prototype._notifyReady=function(){this._onReady&&(this._onReady.forEach(function(t){t()}),this._onReady=null)},e.exports=s},{"./../../../common/js/dom":11}],2:[function(t,e,i){"use strict";var u=t("./../../../common/js/config");function o(t){this._ads=t}o.prototype.isEmpty=function(){for(var t=this._ads||[],e=0;e<t.length;e++)if(t[e].isSupported())return!1;return!0},o.prototype.last=function(){return this._ads[this._ads.length-1]},o.prototype._proceedCreatives=function(t,e){for(var i=t.creatives,o=0;o<i.length;o++)e(i[o])},o.prototype._proceedTrackingUrls=function(t,n,s){this._proceedCreatives(t,function(t){for(var e=(t.linear||{}).trackingEvents||[],i=0;i<e.length;i++){var o=e[i];(o.name||"").toLowerCase()==n&&o.uri&&s(o.uri)}})},o.prototype.getUrls=function(){return this._ads?this._ads.map(function(t){return t._url}).filter(function(t){return!!t}):null},o.prototype.getTracks=function(t,e,i){t=t.toLowerCase();for(var n=[],o=0;o<this._ads.length;o++){var s=this._ads[o]||{},r=s.inLine||s.wrapper||{};if("impression"==t)for(var a=r.impressions||[],h=0;h<a.length;h++){var l=a[h];0<=l.indexOf(u.imp2)&&(l=l.replace(u.imp2,u.imp)),(e||i)&&0<=l.indexOf(u.imp)?this._proceedTrackingUrls(r,"rotate",function(t){n.indexOf(t)<0&&n.push(t)}):n.push(l)}else"error"==t?n.push(r.error):"click"==t?this._proceedCreatives(r,function(t){for(var e=((t.linear||{}).videoClicks||{}).clickTrackings||[],i=0;i<e.length;i++){var o=e[i];o&&n.push(o)}}):this._proceedTrackingUrls(r,t,function(t){n.push(t)})}return n},e.exports=o},{"./../../../common/js/config":10}],3:[function(t,e,i){"use strict";var p=t("./../../../common/js/dom"),n=t("./../../../common/js/utils"),o=t("./../../../common/js/visibility"),_=t("./requester"),m=t("./audiencer"),r=t("./vastTech"),a=t("./vpaidTech"),f=t("./tracker"),g=t("./rotator"),s=["AdStarted","AdPlaying","AdImpression","AdRemainingTimeChange","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete"],h=function(t,e,i,o){this._callback=t,this._logger=e,this._config=i,this._opt=n.extend({logo:!0,time:!0,skip:!0,sound:!0},o||{}),this._rot=null,this._grab=!1,this._slot=null,this._videoSlot=null,this._canSkip=null,this._visible=!0,this._volume=0,this._expanded=!1,this._tech=null,this._tracker=null,this._loaded=!1,this._adLoadFired=!1,this._adStartFired=!1,this._started=!1,this._playingAllowed=!1,this._count=0,this._completed=0,this._techImp=0,this._failed=0,this._skipped=0,this._queue=[]};h.prototype.init=function(t,e,i,o,n,s,r,a,h,l){this._slot=t,this._videoSlot=e,this._ownVideo=!1,this._width=i,this._height=o,this._viewMode=n,this._desiredBitrate=s,this._volume=0,this._logger.dump("Mngr: Tag #"+r+": init"),p.nested(window,function(){this._logger.warn("Mngr: Tag #"+r+": nested-req")}.bind(this),function(){this._logger.warn("Mngr: Tag #"+r+": nested-ack"),this._raiseError()}.bind(this)),a&&f.track(this._slot,a),this._audiencer=new m(this._logger,this._config),this._audiencer.init(this._slot),this._requester=new _(this._config,h,this._audiencer),this._rot=new g(this._audiencer);var u=this._onFetched.bind(this),d=this._proceedJob.bind(this),c=this._proceedSlot.bind(this);this._createSlots(),setTimeout(function(){if(l)u(),this._requester.applyPlacement(l,d,c);else{var t={id:r,width:i,height:o};this._requester.loadPlacement(t,u,d,c)}}.bind(this),20)},h.prototype._onFetched=function(t,e){if(this._logger.dump("Placement fetched"),e)for(var i=0;i<e.length;i++)try{var o=atob(e[i]);this._proceedSnippet(o,i)}catch(t){this._logger.warn("Failed to decode snippet #"+i)}this._waitPriority=!0,setTimeout(this._onPriorityTimeout.bind(this),this._config.priorityTimeout)},h.prototype.destroy=function(){this._callback=null},h.prototype._proceedSnippet=function(e,i){setTimeout(function(){try{var t=p.html(e);this._slot.appendChild(t)}catch(t){this._logger.warn("Failed to add snippet #"+i)}}.bind(this),20)},h.prototype._proceedSlot=function(t){this._rot.init(t),this._opt.timingPolicy=(t||{}).tp||null,this._callEvent("AdSlot",t)},h.prototype._rotSlot=function(){return this._rot.rot1()},h.prototype._onPriorityTimeout=function(){this._waitPriority=!1,this._logger.dump("Priority timeout expired"),0<this._queue.length&&this._runJobLoop()},h.prototype._ensureAdLoadFired=function(){return!!this._adLoadFired||(this._adLoadFired=!0,this._callEvent("AdLoaded"),!1)},h.prototype._ensureAdStartFired=function(){return!!this._adStartFired||(this._adStartFired=!0,this._callEvent("AdStarted",null,null,!0),!1)},h.prototype._proceedJob=function(t){this._logger.dump("Mngr: Got new job: "+(t?"["+t.index+"]: "+(t.pos?"<rot>":"<any>")+(t.empty?"<empty>":"<valid>"):"<null>")),t&&(this._queue.push(t),t.empty)||t&&(t.index||!this._canRunJob(t))&&this._waitPriority||this._runJobLoop()},h.prototype._runJobLoop=function(){if(!this._loaded){if(this._logger.dump("Mngr: Run job loop"),this._loaded=!0,0<this._queue.length){this._callEvent("AdFetched");var t=this._config.visRatio;if(t&&o.observe(this._slot,t,this._onVisibleChange.bind(this)),this._prepareNextTech())return void(this._opt.immediateLoad&&this._ensureAdLoadFired())}this._raiseError("No ads")}},h.prototype.start=function(){if(!this._tech)return this._logger.warn("Mngr: No tech to start"),void this._raiseError();this._playingAllowed=!0,this._startTech()},h.prototype.stop=function(){this._playingAllowed=!1,this._stopTech(),this._raiseEnd()},h.prototype.pause=function(){this._playingAllowed=!1,this._tech&&this._tech.pause()},h.prototype.resume=function(){this._tech&&(this._playingAllowed=!0,this._tech.resume())},h.prototype.expand=function(){this._expanded||(this._expanded=!0,this._videoSlot.requestFullscreen?this._videoSlot.requestFullscreen():this._logger.warn("Mngr: Full screen is not supported for element"),this._callEvent("AdExpanded"),this._callEvent("AdExpandedChange"))},h.prototype.collapse=function(){this._expanded&&(this._expanded=!1,this._videoSlot.exitFullscreen?this._videoSlot.exitFullscreen():this._videoSlot.cancelFullscreen?this._videoSlot.cancelFullscreen():this._logger.warn("Mngr: Full screen is not supported for element"),this._callEvent("AdCollapsed"),this._callEvent("AdExpandedChange"))},h.prototype.isExpanded=function(){return this._expanded},h.prototype.isSkippable=function(){return this._canSkip||this._tech&&this._tech.isSkippable()},h.prototype.hasIcons=function(){return this._tech&&this._tech.hasIcons()},h.prototype.skip=function(){var t;this.isSkippable()&&(this._skipped++,this._opt.skipAll?(this._logger.debug("Mngr: Skip all slots"),t=this._raiseEnd.bind(this)):(this._logger.debug("Mngr: Skip slot #"+this._tech.id),t=this._stopTech.bind(this),this._canSkip=!1,this._upSkipSlot()),this._track("skip",!1),t())},h.prototype.creativeSize=function(){return this._tech&&this._tech.creativeSize()},h.prototype.getSize=function(){return{width:this._width,height:this._height}},h.prototype.resize=function(t,e,i){this._width=t,this._height=e,this._viewMode=i,this._tech&&this._tech.resize(this._width,this._height,this._viewMode),this._callEvent("AdSizeChange")},h.prototype.setVolume=function(t){t=(t||0).toFixed(2),this._volume!=t&&(this._trackVolume(this._volume,t),this._volume=t,this._updateVolume(),this._callEvent("AdVolumeChange"))},h.prototype.mute=function(){this._logger.debug("Mngr: Mute"),this.setVolume(0)},h.prototype.unmute=function(){this._logger.debug("Mngr: Unmute"),this.setVolume(1)},h.prototype.getVolume=function(){return parseFloat((this._tech?this._tech.getVolume():null)||this._volume)},h.prototype.getDuration=function(){return this._tech?this._tech.duration():null},h.prototype.getRemainingTime=function(){return this._tech?this._tech.remainingTime():0},h.prototype.getCurrentTime=function(){var t=this.getDuration();t=isNaN(t)?0:t;var e=this.getRemainingTime();return(e=isNaN(e)?0:e)<t?t-e:0},h.prototype.isLinear=function(){return!this._tech||this._tech.isLinear()},h.prototype.onTechLoad=function(){this._logger.debug("Mngr: Slot #"+this._tech.id+" loaded."),this._upLogoSlot(),this._upSoundSlot(),this._upSkipSlot(),this._ensureAdLoadFired()&&this._startTech()},h.prototype.onTechStart=function(){this._logger.debug("Mngr: Slot #"+this._tech.id+" started."),this._started=!0,this._techImp=0,this._upTimeSlot(),this._track("creativeView",!0),this._ensureAdStartFired(),this._callEvent("AdPlaying")},h.prototype.onTechEnd=function(){this._logger.debug("Mngr: Slot #"+this._tech.id+" finished."),this._completed++,this._endTech()},h.prototype.onTechPause=function(){this._logger.debug("Mngr: Slot #"+this._tech.id+" paused."),this._track("pause",!1),this._callEvent("AdPaused")},h.prototype.onTechResume=function(){this._logger.debug("Mngr: Slot #"+this._tech.id+" resumed."),this._track("resume",!1),this._callEvent("AdResumed"),this._callEvent("AdPlaying")},h.prototype.onTechError=function(){this._tech&&(this._logger.warn("Mngr: Slot #"+this._tech.id+" error."),this._failed++,this._endTech())},h.prototype.onTechSkippableChange=function(){this._upSkipSlot(),this._callEvent("AdSkippableStateChange")},h.prototype.onTechLinearChange=function(){this._callEvent("AdLinearChange")},h.prototype.onTechVolumeChange=function(){var t=this._tech.getVolume().toFixed(2),e=this._volume;t!=e&&(this._volume=t,this._callEvent("AdVolumeChange"),this._trackVolume(e,t))},h.prototype.onTechImpression=function(){setTimeout(function(){if(this._track("impression",!1,this._techImp),this._techImp++,!this._canSkip){var t=this._opt.skipTime;0<t&&(this._canSkip=!1,setTimeout(this.onCanSkip.bind(this),1e3*t))}setTimeout(function(){this._callEvent("AdImpression"),this._rot.count(!this._grab)}.bind(this),1)}.bind(this),50)},h.prototype.onTechClickThru=function(t,e,i){if(i){var o=window.open(t,"_blank");o&&o.focus()}this._track("click",!1),this._callEvent("AdClickThru",[t,e,!1])},h.prototype.onTechQuartile=function(t){"AdVideoStart"==t?this._track("start",!1):"AdVideoFirstQuartile"==t?this._track("firstQuartile",!1):"AdVideoMidpoint"==t?this._track("midpoint",!1):"AdVideoThirdQuartile"==t?this._track("thirdQuartile",!1):"AdVideoComplete"==t&&(this._track("complete",!1),this._checkCanImpress()),this._callEvent(t)},h.prototype.onTechDurationChange=function(){this._callEvent("AdDurationChange")},h.prototype.onTechRemainingTimeChange=function(){if(this._elemTime){var t=this.getRemainingTime();!isNaN(t)&&0<=t?this._elemTime.innerHTML=this._config.timeText.replace("{time}",Math.round(t)):p.display(this._elemTime,!1)}this._callEvent("AdRemainingTimeChange")},h.prototype.onCanSkip=function(){this._canSkip=!0,this._logger.dump("Mngr: Allow skip by timeout."),this.onTechSkippableChange()},h.prototype._startTech=function(){this._tech&&(this._ensureAdStartFired(),this._tech.isLoaded()&&this._tech.start())},h.prototype._stopTech=function(){this._tech&&this._tech.stop()},h.prototype._endTech=function(){this._cleanupTech(),this._callEvent("AdComplete"),this._prepareNextTech()||(this._started&&0<this._completed?this._raiseEnd():this._raiseError())},h.prototype._canRunJob=function(t){return!t.pos||this._grab},h.prototype._findNextJob=function(){this._queue.sort(function(t,e){return t.index-e.index});for(var t=0;t<this._queue.length;){var e=this._queue[t];if(this._canRunJob(e)){if(!e.empty)return this._logger.dump("Mngr: Found runnable job ["+e.index+"]."),this._queue.splice(t,1),e;this._logger.dump("Mngr: Found empty job ["+e.index+"]."),this._queue.splice(t,1),new f(this._logger,this._slot,e.chain).track("request",!1,!1,!1)}else t++}return this._logger.dump("Mngr: No next job found."),null},h.prototype._prepareNextTech=function(){if(this._logger.dump("Mngr: Prepare next tech."),!this._canImpress())return!1;this._grab=this._rot.canGrab();var t=this._findNextJob();if(!t)return!1;if(this._tech=this._resolveTech(t),this._tech){if(this._logger.dump("Mngr: Slot #"+this._tech.id+": job ["+t.index+"] : tech resolved for chain:\n"+(t.chain.getUrls()||[]).join("\n\t")),this._tracker=new f(this._logger,this._slot,t.chain),this._ensureVideoSlot(),this._track("request",!0),this._tech.init(this,this._logger,this._slot,this._videoSlot,this._width,this._height,this._viewMode,this._desiredBitrate,t.chain.last(),this._opt))return this._updateVolume(),!0;this._logger.warn("Mngr: Failed to initialize slot tech. Pass to next slot")}return this._prepareNextTech()},h.prototype._canImpress=function(){return this._rot.canImpress()},h.prototype._checkCanImpress=function(){this._canImpress()||setTimeout(function(){this._logger.dump("Mngr: Impression limits reached."),this._raiseEnd()}.bind(this),100)},h.prototype._nextSlotId=function(){return++this._count},h.prototype._resolveTech=function(t){var e=t.type;if("display"==e)return this._logger.warn("Mngr: Not supported DISPLAY tech"),null;if("video"==e){for(var i=t.chain.last().getMediaFiles(),o=0;o<i.length;o++){var n=i[o],s=n.isVAST()?new r(this._nextSlotId()):n.isVPAID()?new a(this._nextSlotId()):null;return s&&(s.job=t),s}this._logger.warn("Mngr: Not supported VIDEO tech. Only VAST is supported at the moment.")}else this._logger.warn("Mngr: Unknown tech type: "+e);return null},h.prototype._upTimeSlot=function(){this._upSlot("_elemTime",this.hasIcons())},h.prototype._upLogoSlot=function(){this._upSlot("_elemLogo",this.hasIcons())},h.prototype._upSoundSlot=function(){this._upSlot("_elemSound",this.hasIcons())},h.prototype._upSkipSlot=function(){this._upSlot("_elemSkip",this._canSkip||this.hasIcons()&&this.isSkippable())},h.prototype._upSlot=function(t,e){var i=this[t];p.display(i,e)},h.prototype._createSlots=function(){[this._opt.time?["_elemTime","vdf-time",null,null]:null,this._opt.logo?["_elemLogo","vdf-logo",this._config.logoHtml,null]:null,this._opt.skip?["_elemSkip","vdf-skip",this._config.skipText,this._onSkipClick.bind(this)]:null,this._opt.sound?["_elemSound","vdf-sound","",this._onSoundClick.bind(this)]:null].forEach(function(t){if(t){var e=t[0];this._ensureElement(t[0],t[1],t[2],t[3]),p.display(this[e],!1)}}.bind(this))},h.prototype._ensureElement=function(t,e,i,o){if(!this[t]){var n=this[t]=document.createElement("div");p.attribs(n,{class:"vdf-bg vdf-rounded "+e}),o&&p.event(n,"click",o),i&&(n.innerHTML=i),this._slot.appendChild(n)}},h.prototype._onSoundClick=function(){0<this._volume?this.mute():this.unmute()},h.prototype._onSkipClick=function(){this.skip()},h.prototype._onVisibleChange=function(t,e){this._visible=e&&t>=this._config.visRatio,this._logger.debug("Mngr: visibility changed: "+this._visible+" (ratio: "+t+", page: "+e+")")},h.prototype._ensureVideoSlot=function(){this._videoSlot=document.createElement("video");var t={"webkit-playsinline":!0,playsinline:!0,autoplay:!1,muted:!0};p.attribs(this._videoSlot,t),p.props(this._videoSlot,t),p.styles(this._videoSlot,{position:"absolute",left:"0px",top:"0px",width:this._width,height:this._height}),this._slot.appendChild(this._videoSlot),this._ownVideo=!0},h.prototype._cleanupTech=function(){this._tech&&(this._tech.cleanup(),this._tech=null),this._tracker&&(this._tracker=null),this._upLogoSlot(),this._upSkipSlot(),this._upSoundSlot(),this._upTimeSlot(),[this._ownVideo?"_videoSlot":null].forEach(function(t){var e=t&&this[t];e&&(p.remove(e),this[t]=null)}.bind(this))},h.prototype._trackVolume=function(t,e){t!=e&&(t?e||this._track("mute"):this._track("unmute"))},h.prototype._updateVolume=function(){this._tech&&this._tech.setVolume(this._volume);var t=.01<=parseFloat(this._volume);t&&this._started&&this._ownVideo&&(this._videoSlot.muted=!1),p.class(this._elemSound,"vdf-sound-on",t)},h.prototype._track=function(t,e,i){this._tracker&&this._tracker.track(t,e,this._grab||this._rotSlot(),this._rot.rot0(),i)},h.prototype._raiseEnd=function(){this._callEvent("AdStopped",null,100)},h.prototype._raiseError=function(){this._track("error",!1),this._callEvent("AdError",null,100)},h.prototype._callEvent=function(t,e,i,o){if(this._callback){var n=function(){this._logger.dump("Mngr: fire event "+t),!o&&(this._grab||this._rotSlot())&&0<=s.indexOf(t)&&!this._opt.fireAll||this._callback(t,e)}.bind(this);0<i?setTimeout(n,i):n()}},e.exports=h},{"./../../../common/js/dom":11,"./../../../common/js/utils":13,"./../../../common/js/visibility":14,"./audiencer":1,"./requester":4,"./rotator":5,"./tracker":6,"./vastTech":7,"./vpaidTech":8}],4:[function(t,e,i){"use strict";var n=t("./../../../common/js/ajax"),s=t("./../../../common/js/dom"),a=t("./../../../vast-client/src/vastClient"),h=t("./chain"),o=function(t,e,i){this._config=t,this._count=0,this._ref=e||"",this._aud=i};o.prototype.loadPlacement=function(t,s,r,a){var h=this;this._requestAds(t,function(t,e,i,o,n){s(t,n),e&&a(e),h._proceedVasts(t,i,o,r)},function(){r(null)})},o.prototype.applyPlacement=function(t,e,i){var o=(t=t||{}).tags||[];if(0<o.length){var n=t.slot;n&&i(n);var s=t.pos||[],r=t.lmt||[];this._proceedVasts(o,s,r,e)}else fn(null)},o.prototype._proceedVasts=function(i,o,n,s){this._aud.ready(function(){i=i||[];for(var t=0,e=0;e<i.length;e++)this._unwrapVast(i[e],e,o[e]||0,n[e]||{},s)&&t++;t||s(null)}.bind(this),this._config.audTimeout)},o.prototype._unwrapVast=function(t,i,o,n,s){if(!this._aud.allow(n.key,n.daily))return!1;var r=this,e=new a(this._config.vastTimeout);return this._count++,e.loadXml(t,function(t){r._count--,r._aud.count(n.key);var e=new h(t);s({type:"video",chain:e,index:i,pos:o,limit:n,empty:e.isEmpty()}),r._count||s(null)}),!0},o.prototype._requestAds=function(t,u,d){var c=this._config.multiple,e=s.location(),i=this._config.ads.replace("{id}",t.id).replace("{w}",t.width).replace("{h}",t.height).replace("{mult}",c?1:0).replace("{ref}",encodeURIComponent(this._ref)).replace("{loc}",encodeURIComponent(e)).replace("{ts}",(new Date).getTime()),o=this._config.host+i;n.get(o,this._config.adsTimeout,function(t){var e=[],i=null,o=null,n=null,s=null;if(c)try{e=(t=JSON.parse(t)||{}).tags||[],i=t.slot||{},o=t.pos||[],n=t.lmt||[],s=t.snp||[]}catch(t){e=[]}else'<VAST version="2.0"/>'!==t&&e.push(t);if(0<e.length){for(var r=encodeURIComponent(document.referrer),a=window.location.search.replace("?",""),h=encodeURIComponent(document.title),l=0;l<e.length;l++)e[l]=e[l].replace("{vdf.page.ref}",r).replace("{vdf.page.search}",a).replace("{vdf.page.title}",h);u(e,i,o,n,s)}else d()},function(){d()})},e.exports=o},{"./../../../common/js/ajax":9,"./../../../common/js/dom":11,"./../../../vast-client/src/vastClient":24,"./chain":2}],5:[function(t,e,i){"use strict";var o=function(t){this._aud=t,this._loops=1,this._imps=null,this._pub=null,this._ssp=null,this._rot0=!1,this._rot1=!1,this._scope=null,this._count={loops:0,imps:0,pub:0,ssp:0}};o.prototype.init=function(t){if(t){var e=t.share;0<e?(this._pub=e,this._ssp=null):e<0?(this._ssp=-e,this._pub=null):(this._pub=null,this._ssp=null),this._imps=t.total||null,this._loops=t.loops||null;var i=t.share0;this._rot0=0<i&&i<1&&Math.random()<i,this._scope=t.scope,this._aud.ready(function(){this._updateRot1()}.bind(this))}},o.prototype._updateRot1=function(){this._rot1=0<this._pub&&this._scope&&!this._aud.allow(this._scopeKey(),this._pub)},o.prototype._scopeKey=function(){return"scp_"+this._scope},o.prototype.count=function(t){this._count.imps++,t?this._count.pub++:this._count.ssp++,this._aud.count(this._scopeKey())},o.prototype.exposures=function(){return this._count.imps},o.prototype.loop=function(){this._count.loops++},o.prototype.canImpress=function(){return!this._imps||this._count.imps<this._imps},o.prototype.canLoop=function(){return!this._loops||this._count.loops<this._loops},o.prototype.rot0=function(){return this._rot0},o.prototype.rot1=function(){return this._rot1},o.prototype.canGrab=function(){if(!this._count.pub)return!1;if(this._pub)return this._count.pub>=this._pub;var t=this._ssp;return t&&(t<1?Math.random():this._count.ssp)<t},e.exports=o},{}],6:[function(t,e,i){"use strict";var n=t("./../../../common/js/dom"),s=t("./../../../common/js/utils"),r=n.location(),a=function(t,e,i){this._fired={},this._logger=t,this._slot=e,this._chain=i};a.prototype.track=function(t,e,i,o,n){if(!e||!this._fired[t]){this._fired[t]=(this._fired[t]||0)+1;for(var s=this._chain.getTracks(t,i,o||0),r=s.length-1;0<=r;r--)a.track(this._slot,s[r],n);this._logger.debug("Track: "+t)}},a.track=function(t,e,i){if(e){e=e.replace("{loc}",encodeURIComponent(r)).replace("{eo}",i||"").replace("{cb}",s.cbust());var o=n.createPixel(e);t.appendChild(o)}},e.exports=a},{"./../../../common/js/dom":11,"./../../../common/js/utils":13}],7:[function(t,e,i){"use strict";var o=t("./../../../common/js/config"),n=t("./../../../common/js/dom"),s=function(t){this.id=t,this._videoSlot=null,this._quartileEvents=[{event:"AdVideoStart",value:0},{event:"AdVideoFirstQuartile",value:25},{event:"AdVideoMidpoint",value:50},{event:"AdVideoThirdQuartile",value:75},{event:"AdVideoComplete",value:100}],this._lastQuartileIndex=0,this._handlers={durationchange:this._onDurationChanged.bind(this),timeupdate:this._onTimeUpdated.bind(this),ended:this._onTimeEnded.bind(this)},this._overlay=null,this._impressionFired=!1,this._ready=!1};s.prototype.init=function(t,e,i,o,n,s,r,a,h){return this._host=t,this._logger=e,this._slot=i,this._videoSlot=o,this._width=n,this._height=s,this._viewMode=r,this._desiredBitrate=a,this._ad=h,this._mediaFile=null,this._skippable=!1,this._ensureOverlay(),this._updateVideoSlotSize(),this._updateOverlaySize(),this._updateVideoSlotMedia(),setTimeout(this._host.onTechLoad.bind(this._host),20),!0},s.prototype.isLoaded=function(){return this._ready},s.prototype.start=function(){this._bindVideoSlot(),this._playMedia()},s.prototype.pause=function(){try{this._videoSlot.pause(),this._callHost("onTechPause")}catch(t){this._log("Failed to pause media: "+t,"error")}},s.prototype.resume=function(){this._playMedia(),this._callHost("onTechResume")},s.prototype.stop=function(){this.pause(),this._callHost("onTechEnd")},s.prototype.cleanup=function(){this._host=null,this._unbindVideoSlot(),null!=this._overlay&&(this._slot.removeChild(this._overlay),this._overlay=null)},s.prototype.resize=function(t,e,i){this._width=t,this._height=e,this._viewMode=i,this._updateVideoSlotSize(),this._updateOverlaySize()},s.prototype.duration=function(){var t=this._videoSlot.duration;return isNaN(t)?null:t},s.prototype.remainingTime=function(){var t=this._videoSlot.currentTime;t=isNaN(t)?0:t;var e=(this.duration()||0)-t;return 0<e?e:0},s.prototype.creativeSize=function(){return this._mediaFile?{w:this._mediaFile.width,h:this._mediaFile.height}:null},s.prototype.isLinear=function(){return!0},s.prototype.isSkippable=function(){return this._skippable},s.prototype.hasIcons=function(){return!1},s.prototype.setVolume=function(t){try{this._videoSlot.volume=parseFloat(t),this._log("VastTech: changed volume: "+this._videoSlot.volume,"debug")}catch(t){this._log("Faled to set volume: "+t,"error")}},s.prototype.getVolume=function(){try{return parseFloat(this._videoSlot.volume)}catch(t){return this._logger.warn("Faled to get volume: "+t),null}},s.prototype._playMedia=function(){try{var t=this._videoSlot.play();(t||{}).catch?t.then(this._onPlayStart.bind(this),this._onPlayError.bind(this)):this._onPlayStart()}catch(t){this._onPlayError(t)}},s.prototype._onPlayError=function(t){"NotAllowedError"==(t||{}).name?this._log("Waiting page interaction before the start","warn"):this._log("Failed to play media: "+t,"warn"),this._onError()},s.prototype._onPlayStart=function(){this._impressionFired||(this._impressionFired=!0,this._callHost("onTechStart"),setTimeout(function(){this._callHost("onTechImpression")}.bind(this),1e3))},s.prototype._updateVideoSlotMedia=function(){for(var t=!1,e=this._ad.getMediaFiles(),i=0;i<e.length;i++){var o=e[i];if(""!=this._videoSlot.canPlayType(o.type)){this._mediaFile=o;try{this._videoSlot.pause(),this._videoSlot.setAttribute("src",o.src),this._videoSlot.load(),t=!0;break}catch(t){this._log("Failed to load media at ["+o.src+"]","warn")}}}t?this._ready=!0:this._onError()},s.prototype._ensureOverlay=function(){null==this._overlay&&(this._overlay=document.createElement("div"),n.styles(this._overlay,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",cursor:"pointer"}),n.event(this._overlay,"click",this._onOverlayClick.bind(this)),this._slot.appendChild(this._overlay))},s.prototype._updateOverlaySize=function(){},s.prototype._updateVideoSlotSize=function(){this._log("Resize video slot: "+this._width+"x"+this._height,"debug");var t={width:this._width,height:this._height};n.attribs(this._videoSlot,t),n.props(this._videoSlot,t)},s.prototype._bindVideoSlot=function(){this._videoSlot.addEventListener("timeupdate",this._handlers.timeupdate,!1),this._videoSlot.addEventListener("durationchange",this._handlers.durationchange,!1),this._videoSlot.addEventListener("ended",this._handlers.ended,!1)},s.prototype._unbindVideoSlot=function(){this._videoSlot.removeEventListener("timeupdate",this._handlers.timeupdate),this._videoSlot.removeEventListener("durationchange",this._handlers.durationchange),this._videoSlot.removeEventListener("ended",this._handlers.ended),this._videoSlot.pause(),n.del(this._videoSlot,"src"),this._videoSlot.load()},s.prototype._onOverlayClick=function(){var t=(this._mediaFile&&this._mediaFile.parent&&this._mediaFile.parent.videoClicks||{}).clickThrough;t&&this._callHost("onTechClickThru",t,null,!0)},s.prototype._onDurationChanged=function(){this._callHost("onTechDurationChange")},s.prototype._onTimeEnded=function(){this._callHost("onTechEnd")},s.prototype._onError=function(){this._callHost("onTechError")},s.prototype._onTimeUpdated=function(){if(this._host&&!(this._lastQuartileIndex>=this._quartileEvents.length)){var t=this._host.getDuration();if((0<t?100*this._host.getCurrentTime()/t:0)>=this._quartileEvents[this._lastQuartileIndex].value){var e=this._quartileEvents[this._lastQuartileIndex].event;this._host.onTechQuartile(e),this._lastQuartileIndex+=1,!this._skippable&&this._lastQuartileIndex>=o.skipQuartile&&(this._skippable=!0,this._host.onTechSkippableChange())}this._host.onTechRemainingTimeChange()}},s.prototype._callHost=function(){if(this._host){var t=[].slice.call(arguments),e=t.shift(),i=this._host[e];i&&i.apply(this._host,t)}else this._log("can not call host since it is missed","dump")},s.prototype._log=function(t,e){this._logger[e||"debug"]("VAST #"+this.id+": "+t)},e.exports=s},{"./../../../common/js/config":10,"./../../../common/js/dom":11}],8:[function(t,e,i){"use strict";var o=t("./../../../common/js/dom"),u=t("./../../../common/js/utils"),d={1:{vpaidAdFirstImpression:5e3,vpaidAdRepeatImpression:3e4,vpaidZeroTimeRemain:2e3},2:{vpaidAdFirstImpression:25e3,vpaidAdRepeatImpression:8e4,vpaidZeroTimeRemain:3500},3:{vpaidAdFirstImpression:5e4,vpaidAdRepeatImpression:15e4,vpaidZeroTimeRemain:5e3}},n=function(t){for(var e in this.id=t,this._settings={mediaFileLoadTimeout:5e3,vpaidAdLoadedTimeout:1e4,vpaidAdStartedTimeout:1e4,vpaidAdStoppedTimeout:1e3,vpaidAdResumedTimeout:2e3},this._settings=u.extend(this._settings,d[3]),this._counters={},this._timeouts={},this._version="2.0",this._template='<html><head><script src="{src}"><\/script></head><body></body></html>',this._videoSlot=null,this._ad=null,this._mediaFile=null,this._ready=!1,this._playing=!1,this._ended=!1,this._volume=0,this._callbacks={AdError:this._onAdError,AdLoaded:this._onAdLoaded,AdStarted:this._onStartAd,AdStopped:this._onStopAd,AdPaused:this._onAdPaused,AdPlaying:this._onAdPlaying,AdDurationChange:this._onAdDurationChange,AdRemainingTimeChange:this._onAdRemainingTimeChange,AdLinearChange:this._onAdLinearChange,AdSizeChange:this._onAdSizeChange,AdExpandedChange:this._onAdExpandedChange,AdSkipped:this._onAdSkipped,AdSkippableStateChange:this._onAdSkippableStateChange,AdVolumeChange:this._onAdVolumeChange,AdImpression:this._onAdImpression,AdClickThru:this._onAdClickThru,AdVideoStart:this._onAdVideoStart,AdVideoFirstQuartile:this._onAdVideoFirstQuartile,AdVideoMidpoint:this._onAdVideoMidpoint,AdVideoThirdQuartile:this._onAdVideoThirdQuartile,AdVideoComplete:this._onAdVideoComplete,AdUserAcceptInvitation:this._onAdUserAcceptInvitation,AdUserMinimize:this._onAdUserMinimize,AdInteraction:this._onAdInteraction,AdUserClose:this._onAdUserClose,AdLog:this._onAdLog},this._callbacks)this._callbacks[e]=this._callbacks[e].bind(this)};n.prototype.init=function(t,e,i,o,n,s,r,a,h,l){return this._host=t,this._logger=e,this._slot=i,this._videoSlot=o,this._width=n,this._height=s,this._viewMode=r,this._desiredBitrate=a,this._ad=h,this._settings=u.extend(this._settings,d[l.timingPolicy]||{}),this._initVpaidContainer()},n.prototype._callHost=function(){if(this._host){var t=[].slice.call(arguments),e=t.shift(),i=this._host[e];i?(this._log("call host ["+e+"]","dump"),i.apply(this._host,t)):this._log("host method ["+e+"] not found","dump")}else this._log("can not call host since it is missed","dump")},n.prototype._propagateSize=function(){this._callCreativeMethod("resizeAd",[this._width,this._height,this._viewMode])},n.prototype.start=function(){this._awaitCreativeEvent("AdStarted",this._settings.vpaidAdStartedTimeout),this._callCreativeMethod("startAd",null,!0)},n.prototype.pause=function(){this._callCreativeMethod("pauseAd",null,!0)},n.prototype.resume=function(){this._awaitCreativeEvent("AdPlaying",this._settings.vpaidAdResumedTimeout),this._callCreativeMethod("resumeAd",null,!0)},n.prototype.stop=function(){this._awaitCreativeEvent("AdStopped",this._settings.vpaidAdStoppedTimeout),this._callCreativeMethod("stopAd",null,!0)},n.prototype.cleanup=function(){this._log("cleanup tech","dump"),this._destroyFrame(),this._host=null,this._ended=!0,this._unsubscribe()},n.prototype.resize=function(t,e,i){this._width=t,this._height=e,this._viewMode=i,this._propagateSize()},n.prototype.duration=function(){var t=this._ready?this._callCreativeMethod("getAdDuration"):0;return this._log("duration: return "+t,"dump"),t},n.prototype.remainingTime=function(){var t=this._ready?this._callCreativeMethod("getAdRemainingTime"):0;this._log("remainingTime: return "+t,"dump");var e="ZeroTimeRemain";return(t||0)<=0?this._playing&&!this._isAwaiting(e)&&this._awaitCreativeEvent(e,this._settings.vpaidZeroTimeRemain):this._unawaitCreativeEvent(e),t},n.prototype.creativeSize=function(){return this._creative?{w:this._callCreativeMethod("getAdWidth")||0,h:this._callCreativeMethod("getAdHeight")||0}:null},n.prototype.isLinear=function(){return!this._ready||this._callCreativeMethod("getAdLinear")},n.prototype.isSkippable=function(){return!!this._ready&&this._callCreativeMethod("getAdSkippableState")},n.prototype.hasIcons=function(){return!!this._ready&&this._callCreativeMethod("getAdIcons")},n.prototype.hasControls=function(){return!!this._ready&&this.hasIcons()},n.prototype.setVolume=function(t){this._volume=t||0,this._ready&&this._callCreativeMethod("setAdVolume",[t])},n.prototype.getVolume=function(){return this._volume=(this._ready?this._callCreativeMethod("getAdVolume"):null)||this._volume,this._volume},n.prototype.isLoaded=function(){return this._ready},n.prototype._validateEvent=function(t,e){var i=(this._counters[t]||0)+1;return(this._counters[t]=i)<=(e||1)||(this._log(t+": received event too many times","debug"),!1)},n.prototype._onAdError=function(t){this._log("AdError: "+(t||"Unknown"),"error"),this._onError()},n.prototype._onAdLoaded=function(){var t="AdLoaded";this._log(t,"debug"),this._validateEvent(t)&&(this._unawaitCreativeEvent(t),this._ready=!0,this._impressed=!1,this._callHost("onTechLoad"),this.setVolume(this._volume))},n.prototype._onStartAd=function(){var t="AdStarted";this._validateEvent(t)&&(this._playing=!0,this._log(t,"debug"),this._unawaitCreativeEvent([t,"AdLoaded"]),this._impressed||this._awaitCreativeEvent("AdImpression",this._settings.vpaidAdFirstImpression),this._callHost("onTechStart"))},n.prototype._onStopAd=function(){var t="AdStopped";this._validateEvent(t)&&(this._playing=!1,this._log(t,"debug"),this._unawaitCreativeEvent(["AdStarted","AdLoaded",t,"AdImpression","ZeroTimeRemain"]),this._callHost("onTechEnd"))},n.prototype._onAdPaused=function(){this._log("AdPaused","debug"),this._playing=!1,this._callHost("onTechPause")},n.prototype._onAdPlaying=function(){this._log("AdPlaying","debug"),this._unawaitCreativeEvent("AdPlaying"),this._playing=!0,this._callHost("onTechResume")},n.prototype._onAdImpression=function(){this._log("AdImpression","debug"),this._impressed=!0,this._unawaitCreativeEvent("AdImpression"),this._awaitCreativeEvent("AdImpression",this._settings.vpaidAdRepeatImpression),this._callHost("onTechImpression")},n.prototype._onAdDurationChange=function(){this._callHost("onTechDurationChange")},n.prototype._onAdSizeChange=function(){var t=this.creativeSize();this._log("AdSizeChange: "+t.w+"x"+t.h,"debug")},n.prototype._onAdRemainingTimeChange=function(){this._callHost("onTechRemainingTimeChange")},n.prototype._onAdLinearChange=function(){this._log("AdLinearChange: "+this.isLinear(),"debug"),this._callHost("onTechLinearChange")},n.prototype._onAdSkippableStateChange=function(){this._log("AdSkippableStateChange","debug"),this._callHost("onTechSkippableChange")},n.prototype._onAdSkipped=function(){this._log("AdSkipped","debug")},n.prototype._onAdVolumeChange=function(){this._log("AdVolumeChange","debug"),this._callHost("onTechVolumeChange")},n.prototype._onAdClickThru=function(t,e,i){this._log("AdClickThru","debug"),this._callHost("onTechClickThru",t,e,i)},n.prototype._onAdVideoStart=function(){this._log("AdVideoStart","debug"),this._playing=!0,this._callHost("onTechQuartile","AdVideoStart")},n.prototype._onAdVideoFirstQuartile=function(){this._log("Playback 25%","debug"),this._callHost("onTechQuartile","AdVideoFirstQuartile")},n.prototype._onAdVideoMidpoint=function(){this._log("Playback 50%","debug"),this._callHost("onTechQuartile","AdVideoMidpoint")},n.prototype._onAdVideoThirdQuartile=function(){this._log("Playback 75%","debug"),this._callHost("onTechQuartile","AdVideoThirdQuartile")},n.prototype._onAdVideoComplete=function(){this._log("AdVideoComplete","debug"),this._callHost("onTechQuartile","AdVideoComplete"),this._playing=!1,this._unawaitCreativeEvent("ZeroTimeRemain")},n.prototype._onAdLog=function(t){this._log("AdLog: "+t,"debug")},n.prototype._onAdExpandedChange=function(){this._notSupported("AdExpandedChange")},n.prototype._onAdInteraction=function(t){this._notSupported("AdInteraction")},n.prototype._onAdUserAcceptInvitation=function(){this._notSupported("AdUserAcceptInvitation")},n.prototype._onAdUserMinimize=function(){this._notSupported("AdUserMinimize"),this._log("AdUserMinimize: Not supported","debug")},n.prototype._onAdUserClose=function(){this._notSupported("AdUserClose")},n.prototype._initVpaidContainer=function(){try{return this._mediaFile=this._ad.getMediaFiles(function(t){return t.isSupported()})[0],this._mediaFile?(setTimeout(this._createVpaidFrame.bind(this),10),!0):(this._log("No appropriate VPAID media file found","error"),!1)}catch(t){return this._log("Failed to load VPAID creative: "+t,"error"),!1}},n.prototype._createVpaidFrame=function(){this._createFrame();var t=this._initVpaidCreative.bind(this);this._frame.onload=o.callbackTimeout(t,function(){this._log("Timeout loading VPAID media file","error"),this._onError()}.bind(this),this._settings.mediaFileLoadTimeout);var e=this._mediaFile.src;o.setFrameContent(this._frame,this._template.replace("{src}",e))},n.prototype._initVpaidCreative=function(){var t=this._frame.contentWindow.getVPAIDAd;if(!u.isFunction(t))return this._log("Can't find VPAID entry method getVPAIDAd","error"),void this._onError();if(this._creative=t(),this._checkVpaidApi())if(this._checkVpaidVersion()){this._subscribe();var e={AdParameters:this._mediaFile.parent.adParameters},i={slot:this._frame.contentWindow.document.body,videoSlot:this._videoSlot};this._awaitCreativeEvent("AdLoaded",this._settings.vpaidAdLoadedTimeout),this._callCreativeMethod("initAd",[this._width,this._height,this._viewMode,this._desiredBitrate,e,i],!0)}else this._log("VPAID creative version is not supported","error");else this._log("Valid VPAID interface not found","error")},n.prototype._createFrame=function(){this._frame=o.createFrame(),this._slot.appendChild(this._frame)},n.prototype._destroyFrame=function(){this._frame&&(this._frame.onload=null,o.setFrameContent(this._frame,""),this._slot?this._slot.removeChild(this._frame):this._frame.remove(),this._frame=null)},n.prototype._checkVpaidVersion=function(){return!!this._callCreativeMethod("handshakeVersion",[this._version],!0)},n.prototype._checkVpaidApi=function(){var t=["handshakeVersion","initAd","startAd","stopAd","pauseAd","resumeAd","skipAd","resizeAd","expandAd","collapseAd","subscribe","unsubscribe"];if(!this._creative)return this._log("Missed VPAID creative","error"),!1;for(var e=0;e<t.length;e++)if(!u.isFunction(this._creative[t[e]]))return this._log("Creative doesn't support method "+method,"error"),!1;return!0},n.prototype._awaitCreativeEvent=function(t,e){var i=this._timeouts[t]=setTimeout(function(){this._onEventTimeout(t,i)}.bind(this),e);this._log("Await ["+t+"] with timer #"+i,"dump")},n.prototype._unawaitCreativeEvent=function(t){u.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];this._clearEventTimeout(i)}},n.prototype._unawaitAllCreativeEvent=function(){for(var t in this._timeouts)this._timeouts.hasOwnProperty(t)&&this._clearEventTimeout(t)},n.prototype._clearEventTimeout=function(t){var e=this._timeouts[t];e&&(clearTimeout(e),this._log("Clear ["+t+"] timer #"+e,"dump")),this._timeouts[t]=null},n.prototype._isAwaiting=function(t){return this._timeouts[t]},n.prototype._subscribe=function(){for(var t in this._callbacks)this._callCreativeMethod("subscribe",[this._callbacks[t],t,this],!0)},n.prototype._unsubscribe=function(){if(this._creative)for(var t in this._log("Unsubscribe creative events","dump"),this._callbacks)this._callCreativeMethod("unsubscribe",[this._callbacks[t],t])},n.prototype._callCreativeMethod=function(e,i,t){try{if(this._creative){var o=(this._creative||{})[e];if(o)return this._log("Call creative method <"+e+">","dump"),o.apply(this._creative,i);this._log("Creative does not implement method <"+e+">","error")}else{if(!t)return;this._log("Creative is missed. Unable to call method <"+e+">","error")}}catch(t){this._log("Failed to execite VPAID method <"+e+">("+(i&&i.toString())+"): "+t+" : "+t.stack,"error")}this._onError()},n.prototype._onEventTimeout=function(t,e){this._log("Event timeout: "+t+" timer #"+e,"error"),this._onError()},n.prototype._notSupported=function(t){this._log(t+": Not supported","debug")},n.prototype._onError=function(){this._unawaitAllCreativeEvent(),this._ended||this._callHost("onTechError")},n.prototype._log=function(t,e){this._logger[e||"debug"]("VPAID #"+this.id+": "+t)},e.exports=n},{"./../../../common/js/dom":11,"./../../../common/js/utils":13}],9:[function(t,e,i){"use strict";e.exports={get:function(e,t,i,o){var n=new XMLHttpRequest;n.timeout=t,n.withCredentials=!0,n.onreadystatechange=function(){if(4===n.readyState){var t=n.status;if(200<=t&&t<300)return void i(n.responseText);o&&(console.log('Failed to load url "'+e+'": '+n.status),o())}},n.open("GET",e,!0),n.send()}}},{}],10:[function(t,e,i){"use strict";var o="https://cdn.adlook.me";e.exports={host:"https://ads2.adlook.me",ads:"/vast?id={id}&w={w}&h={h}&mult={mult}&rw=0&ref={ref}&loc={loc}&_ts={ts}",cds:"/u/cds.html",cdn:o,audTimeout:150,timeText:"Реклама {time} сек",skipText:"Пропустить &raquo;",skipQuartile:2,logoHtml:'<a href="http://publishers.adlook.me/" target="_blank"><img src="'+o+'/i/logo.png" border="0"/>AdLook.Me</a>',imp:"cli_impression",imp2:"cli_imps",multiple:!0,adsTimeout:5e3,vastTimeout:5e3,priorityTimeout:1e3,visRatio2:.4}},{}],11:[function(t,e,i){"use strict";function o(t,e){if(t)for(var i in e)e.hasOwnProperty(i)&&(t.style[i]=e[i])}function n(t,e){for(var i in e)e.hasOwnProperty(i)&&t.setAttribute(i,e[i])}function s(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,i)}function r(t,e){t&&(t.innerHTML=e)}function a(t,e){var i=t.getAttribute("allow")||"";i.indexOf(e)<0&&t.setAttribute("allow",(i?i+";":"")+e)}function h(t,e){t&&t.postMessage(e,"*")}function l(t,e){t&&t.addEventListener("message",e,!1)}e.exports={styles:o,css:function(t){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,e.media="all",document.getElementsByTagName("head")[0].appendChild(e)},script:function(t,e){var i=document.createElement("script");i.src=t,e&&s(i,"load",e),document.getElementsByTagName("head")[0].appendChild(i)},class:function(t,e,i){if(t){var o=t.getAttribute("class")||"";!i&&0<=o.indexOf(e)?t.setAttribute("class",o.replace(e,"")):i&&o.indexOf(e)<0&&t.setAttribute("class",o+" "+e)}},attrib:function(t,e,i){if(!i)return t.getAttribute(e);t.setAttribute(e,i)},attribs:n,del:function(t,e){t.removeAttribute?t.removeAttribute(e):t[e]&&delete t[e]},props:function(t,e){for(var i in e)if(e.hasOwnProperty(i))try{t[i]=e[i]}catch(t){}},event:s,unevent:function(t,e,i){t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent&&t.detachEvent("on"+e,i)},display:function(t,e){o(t,{display:e?"block":"none"})},width:function(t){return t.offsetWidth||t.clientWidth||t.width||t.outerWidth||t.innerWidth||0},height:function(t){return t.offsetHeight||t.clientHeight||t.height||t.outerHeight||t.innerHeight||0},offset:function(t){for(var e=t.offsetParent,i={left:0,top:0};t&&t!==e;)i.left+=isNaN(t.offsetLeft)?0:t.offsetLeft,i.top+=isNaN(t.offsetTop)?0:t.offsetTop,t=t.offsetParent;return i},location:function(){var e;try{e=window.top.location.href}catch(t){e=null}if(!e){var t=window;try{for(;t.parent!==t;)e=(t=t.parent).location.href}catch(t){e=null}}if(!e)try{var i=window.location.ancestorOrigins||[],o=i.length;e=o?i[o-1]:null}catch(t){e=null}return e||(e=document.referrer||document.location.href),e},remove:function(t){t&&t.parentElement&&t.parentElement.removeChild(t)},empty:function(t){r(t,"")},fireEvent:function(t,e){try{var i=document.createEvent("Event");i.initEvent(e,!0,!0),t.dispatchEvent(i)}catch(t){}},createFrame:function(t,e){var i=document.createElement("iframe");return i.marginWidth="0",i.marginHeight="0",i.frameBorder="0",i.width=e?"0":"100%",i.height=e?"0":"100%",o(i,{position:"absolute",left:e?"-1000px":"0",top:e?"-1000px":"0",margin:"0px",padding:"0px",border:"none",width:e?"0":"100%",height:e?"0":"100%"}),i.setAttribute("scrolling","no"),e||a(i,"autoplay"),t&&i.setAttribute("src",t),i},allowFrame:a,setFrameContent:function(t,e){var i=(t.contentWindow||{}).document;return!!i&&(i.open(),i.write(e),i.close(),!0)},callbackTimeout:function(t,e,i){var o=setTimeout(function(){t=null,e&&e()},i);return function(){e=null,clearTimeout(o),t&&t(arguments)}},methodTimeout:function(t,e,i,o,n,s,r){var a=setTimeout(s,r);try{var h=t.apply(e,i);return clearTimeout(a),h}catch(t){clearTimeout(a),n()}},createPixel:function(t){var e=document.createElement("img");return o(e,{position:"absolute",left:"-10000px",top:"-10000px",width:"1px",height:"1px",border:"none"}),e.src=t,e},post:h,receive:l,nested:function(t,i,o){var n="nest-req",s="nest-ack";l(t,function(t){var e=(t||{}).data;e==s?o&&o():e==n&&(setTimeout(function(){h(t.source,s)},20),i&&i())});for(var e=t;null!=e;)try{e!==e.parent?h(e=e.parent,n):e=null}catch(t){e=null}},html:function(t,e){var i=document.createElement("div");return t&&r(i,t),e&&n(i,e),i},inner:r,hash:function(t){var e=(window.location.hash||"").substr(1)||"";return e.startsWith(t)?e.substr(t.length):null}}},{}],12:[function(t,e,i){"use strict";var o=function(t,e){this._t0=Date.now(),this.prefix=e||"",this.prefix&&(this.prefix=this.prefix+": "),this.level=t||2};o.prototype.error=function(t){this._log("Error",t,1,"error")},o.prototype.warn=function(t){this._log("Warn",t,2,"warn")},o.prototype.debug=function(t){this._log("Debug",t,3)},o.prototype.dump=function(t){this._log("Dump",t,4)},o.prototype._log=function(t,e,i,o){if(i<=this.level){var n=Date.now()-this._t0;console[o||"log"](t+" ["+(n/1e3).toFixed(1)+"s]: "+this.prefix+e)}},e.exports=o},{}],13:[function(t,e,i){"use strict";var o=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function s(t){return void 0===t}function r(t){return"object"==typeof t}function n(t){return"number"==typeof t}function a(t){return"[object Array]"===Object.prototype.toString.call(t)}function h(t){return"string"==typeof t}function l(){return"https:"===window.location.protocol}function u(t,e){if(t&&e)for(var i=0;i<t.length;i++)e(t[i],i)}e.exports={isUndefined:s,isObject:r,isFunction:function(t){return"function"==typeof t},isNumber:n,isEmpty:function(t){return(h(t)||a(t))&&0===t.length},isArray:a,isString:h,isEqual:function(t,e){t=t||{},e=e||{};var i=0;for(var o in t)if(t.hasOwnProperty(o)&&(i++,t[o]!=e[o]))return!1;var n=0;for(var o in e)e.hasOwnProperty(o)&&n++;return i==n},contains:function(t,e){return-1!==t.indexOf(e)},each:u,extend:function t(e){var i,o,n;for(o=1;o<arguments.length;o++)for(n in i=arguments[o])i.hasOwnProperty(n)&&(r(e[n])&&null!==e[n]&&r(i[n])?e[n]=t({},e[n],i[n]):e[n]=i[n]);return e},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},decapitalize:function(t){return t.charAt(0).toLowerCase()+t.slice(1)},transform:function(t,o){var n=[];return t.forEach(function(t,e){var i=o(t,e);s(i)||n.push(i)}),n},isDateISO8601:function(t){return n(t)&&(t+=""),!!h(t)&&o.test(t.trim())},isHttps:l,ensureProtocol:function(t){return l()?t.replace(/http\:\/\//gi,"https://"):t},toJson:function(t){try{return JSON.parse(t)}catch(t){return null}},toParams:function(t,e,o){var n={};return u((t||"").split(e||"&")||[],function(t){var e=(t||"").split(o||"="),i=e[0];i&&(n[i]=e[1])}),n},cbust:function(){return(new Date).getTime()+""+Math.floor(1e5*Math.random())}}},{}],14:[function(t,e,i){"use strict";var s=t("./utils"),r=t("./dom"),a=null,h=!1;var l={};function u(){for(var t in l)if(l.hasOwnProperty(t)){var e=l[t],i=e.observer.takeRecords();e.callback(i.length?i:e.entries)}}e.exports={observe:function(i,t,o){if(s.isUndefined(IntersectionObserver))setTimeout(function(){o(!0,1)},5);else{!function(){var t;h||(h=!0,s.isUndefined(document.hidden)?s.isUndefined(document.msHidden)?s.isUndefined(document.webkitHidden)||(a="webkitHidden",t="webkitvisibilitychange"):(a="msHidden",t="msvisibilitychange"):(a="hidden",t="visibilitychange"),t&&r.event(document,t,u))}();var e=function(t){l[i].entries=t;var e=!a||!document[a];t.forEach(function(t){o(t.intersectionRatio,e)})},n=new IntersectionObserver(e,{threshold:t});l[i]={observer:n,callback:e,entries:null},n.observe(i)}},unobserve:function(t){var e=(l[t]||{}).observer;e&&(e.disconnect(),delete l[t])}}},{"./dom":11,"./utils":13}],15:[function(t,e,i){"use strict";var o=t("./../parsers"),n=t("./../xml");e.exports=function t(e,i){if(!(this instanceof t))return new t(e,i);this.name=e.attr("event"),this.uri=n.keyValue(e),"progress"==this.name&&(this.offset=o.parseOffset(e.attr("offset"),i))}},{"./../parsers":23,"./../xml":25}],16:[function(t,e,i){"use strict";var o=t("./../../../common/js/utils"),n=t("./../xml");e.exports=function t(e){if(!(this instanceof t))return new t(e);function i(t){var e=[];return t&&(t=o.isArray(t)?t:[t]).forEach(function(t){e.push(n.keyValue(t))}),e}this.clickThrough=n.keyValue(e.clickThrough),this.clickTrackings=i(e.clickTracking),this.customClicks=i(e.customClick)}},{"./../../../common/js/utils":13,"./../xml":25}],17:[function(t,e,i){"use strict";var o=t("./inline"),n=t("./wrapper");function s(t){if(!(this instanceof s))return new s(t);this.initialize(t)}s.prototype.initialize=function(t){this.id=t.attr("id"),this.sequence=t.attr("sequence"),t.inLine&&(this.inLine=new o(t.inLine)),t.wrapper&&(this.wrapper=new n(t.wrapper))},s.prototype.getMediaFiles=function(e){var i=[];return((this.inLine||{}).creatives||[]).forEach(function(t){((t.linear||{}).mediaFiles||[]).forEach(function(t){e&&!e(t)||i.push(t)})}),i},s.prototype.isWrapper=function(){return this.wrapper&&this.wrapper.VASTAdTagURI},s.prototype.isSupported=function(){return this.inLine&&this.inLine.isSupported()},e.exports=s},{"./inline":19,"./wrapper":22}],18:[function(t,e,i){"use strict";var o=t("./linear"),n=t("./../../../common/js/utils");function s(t){if(!(this instanceof s))return new s(t);this.id=t.attr("id"),this.sequence=t.attr("sequence"),this.adId=t.attr("adId"),this.apiFramework=t.attr("apiFramework"),t.linear&&(this.linear=new o(t.linear))}s.parseMultiple=function(t){var e=[];return n.isUndefined(t)||n.isUndefined(t.creative)||(n.isArray(t.creative)?t.creative:[t.creative]).forEach(function(t){e.push(new s(t))}),e},s.prototype.isSupported=function(){return!this.linear||this.linear.isSupported()},e.exports=s},{"./../../../common/js/utils":13,"./linear":20}],19:[function(t,e,i){"use strict";var o=t("./../parsers"),n=t("./../xml"),s=t("./creative");function r(t){if(!(this instanceof r))return new r(t);this.adTitle=n.keyValue(t.adTitle),this.adSystem=n.keyValue(t.adSystem),this.impressions=o.parseImpressions(t.impression),this.creatives=s.parseMultiple(t.creatives),this.description=n.keyValue(t.description),this.advertiser=n.keyValue(t.advertiser),this.error=n.keyValue(t.error),this.pricing=n.keyValue(t.pricing),this.extensions=t.extensions}r.prototype.isSupported=function(){var t,e=this.creatives.length;if(0===e)return!1;for(t=0;t<e;t++)if(!this.creatives[t].isSupported())return!1;return!0},e.exports=r},{"./../parsers":23,"./../xml":25,"./creative":18}],20:[function(t,e,i){"use strict";var s=t("./TrackingEvent"),n=t("./mediaFile"),o=t("./VideoClicks"),r=t("./../../../common/js/utils"),a=t("./../parsers"),h=t("./../xml");function l(t){if(!(this instanceof l))return new l(t);this.duration=a.parseDuration(h.keyValue(t.duration)),this.mediaFiles=function(t,i){var o=[];r.isUndefined(t)||(t=r.isArray(t)?t:[t]).forEach(function(t){var e=new n(t);e.parent=i,o.push(e)}.bind(this));return o}(t.mediaFiles&&t.mediaFiles.mediaFile,this),this.trackingEvents=function(t,i,o){var n=[];r.isUndefined(t)||(t=r.isArray(t)?t:[t]).forEach(function(t){var e=new s(t,i);e.parent=o,n.push(e)}.bind(this));return n}(t.trackingEvents&&t.trackingEvents.tracking,this.duration,this),this.skipoffset=a.parseOffset(h.attr(t,"skipoffset"),this.duration),t.videoClicks&&(this.videoClicks=new o(t.videoClicks)),t.adParameters&&(this.adParameters=h.keyValue(t.adParameters),h.attr(t.adParameters,"xmlEncoded")&&(this.adParameters=h.decode(this.adParameters)))}l.prototype.isSupported=function(){var t,e;for(t=0,e=this.mediaFiles.length;t<e;t++)if(this.mediaFiles[t].isSupported())return!0;return!1},e.exports=l},{"./../../../common/js/utils":13,"./../parsers":23,"./../xml":25,"./TrackingEvent":15,"./VideoClicks":16,"./mediaFile":21}],21:[function(t,e,i){"use strict";var o=t("./../xml"),n=["delivery","type","width","height","codec","id","bitrate","minBitrate","maxBitrate","scalable","maintainAspectRatio","apiFramework"],s=["text/javascript","text/javascript1.0","text/javascript1.2","text/javascript1.4","text/jscript","application/javascript","application/x-javascript","text/ecmascript","text/ecmascript1.0","text/ecmascript1.2","text/ecmascript1.4","text/livescript","application/ecmascript","application/x-ecmascript"];function r(t){if(!(this instanceof r))return new r(t);this.src=o.keyValue(t);for(var e=0;e<n.length;e++){var i=n[e];this[i]=t.attr(i)}}r.prototype.isVPAID=function(){return"VPAID"===(this.apiFramework||"").toUpperCase()},r.prototype.isVAST=function(){return!this.apiFramework||"VAST"===this.apiFramework.toUpperCase()},r.prototype.isSupported=function(){return this.isVPAID()?0<=s.indexOf(this.type||""):"video/x-flv"!=this.type},e.exports=r},{"./../xml":25}],22:[function(t,e,i){"use strict";var o=t("./../../../common/js/utils"),n=t("./../parsers"),s=t("./../xml"),r=t("./creative");e.exports=function t(e){if(!(this instanceof t))return new t(e);this.adSystem=s.keyValue(e.adSystem),this.impressions=n.parseImpressions(e.impression),this.VASTAdTagURI=s.keyValue(e.vASTAdTagURI),this.creatives=r.parseMultiple(e.creatives),this.error=s.keyValue(e.error),this.extensions=e.extensions;var i=s.attr(e,"followAdditionalWrappers");this.followAdditionalWrappers=!!o.isUndefined(i)||i,this.allowMultipleAds=s.attr(e,"allowMultipleAds"),this.fallbackOnNoAd=s.attr(e,"fallbackOnNoAd")}},{"./../../../common/js/utils":13,"./../parsers":23,"./../xml":25,"./creative":18}],23:[function(t,e,i){"use strict";var r=t("./../../common/js/utils");function n(t){var e,i,o,n,s;return r.isString(t)&&(e=t.match(/(\d\d):(\d\d):(\d\d)(\.(\d\d\d))?/))&&(s=e[1],i=60*parseInt(s,10)*60*1e3+(n=e[2],60*parseInt(n,10)*1e3)+(o=e[3],1e3*parseInt(o,10))+parseInt(e[5]||0)),isNaN(i)?null:i}e.exports={parseDuration:n,parseOffset:function(t,e){return/^\d+(\.\d+)?%$/g.test(t)?(i=t,(o=e)?o*parseFloat(i.replace("%",""))/100:null):n(t);var i,o},parseImpressions:function(t){return t?(t=r.isArray(t)?t:[t],r.transform(t,function(t){return r.isEmpty(t.keyValue)?void 0:t.keyValue})):[]}}},{"./../../common/js/utils":13}],24:[function(t,e,i){"use strict";e.exports=window.VastClient=function(n){var s=t("./../../common/js/utils"),r=t("./../../common/js/ajax"),i=t("./xml"),o=t("./model/ad");function a(t){try{var e=i.toJXON(t);return function(t){var e=t?new o(t):null;return function(t){return t&&(t.isSupported()||t.isWrapper())}(e)?e:null}(s.isArray(e.ad)?e.ad[0]:e.ad)}catch(t){return console.warn("Unexpected failure while proceed VAST: "+t+". Stack: "+t.stack),null}}function h(e,i,o){!function(t,i){function o(){console.warn("Failed to load VAST from "+t),i(null)}t=s.ensureProtocol(t),r.get(t,n||1e3,function(t){var e=a(t);e?i(e):o()},function(){o()})}(e,function(t){t&&(t._url=e),l(t,i,o)})}function l(t,e,i){t&&e.push(t),t&&t.wrapper?h(t.wrapper.VASTAdTagURI,e,i):i(e)}return{loadUrl:function(t,e){h(t,[],function(t){setTimeout(function(){e(t)},50)})},loadXml:function(t,e){l(a(t),[],function(t){setTimeout(function(){e(t)},50)})}}}},{"./../../common/js/ajax":9,"./../../common/js/utils":13,"./model/ad":17,"./xml":25}],25:[function(t,e,i){"use strict";var h=t("./../../common/js/utils");function o(t){if(h.isUndefined(window.DOMParser)){var e=new ActiveXObject("Microsoft.XMLDOM");return e.async=!1,e.loadXML(t),e}var i,o=new DOMParser;try{if(0<(i=o.parseFromString(t,"application/xml")).getElementsByTagName("parsererror").length)throw new Error("XML parsing error: unknown reason")}catch(t){throw new Error("XML parsing error: "+t)}return i}function l(t){return/^\s*$/.test(t)?null:/^(?:true|false)$/i.test(t)?"true"===t.toLowerCase():isFinite(t)?parseFloat(t):h.isDateISO8601(t)?new Date(t):t.trim()}function u(t){if(t.documentElement)return new u(t.documentElement);if(t.hasChildNodes()){for(var e,i,o,n="",s=0;s<t.childNodes.length;s++)3==((e=t.childNodes.item(s)).nodeType-1|1)?n+=3===e.nodeType?e.nodeValue.trim():e.nodeValue:1!==e.nodeType||e.prefix||(i=h.decapitalize(e.nodeName),o=new u(e),this.hasOwnProperty(i)?(this[i].constructor!==Array&&(this[i]=[this[i]]),this[i].push(o)):this[i]=o);n&&(this.keyValue=l(n))}if(h.isUndefined(t.hasAttributes)?0<t.attributes.length:t.hasAttributes())for(var r,a=0;a<t.attributes.length;a++)r=t.attributes.item(a),this["@"+h.decapitalize(r.name)]=l(r.value.trim())}function n(t,e){if(t)return t["@"+h.decapitalize(e)]}u.prototype.attr=function(t){return n(this,t)},e.exports={toXMLDoc:o,toJXON:function(t){return new u(o(t))},keyValue:function(t){if(t)return t.keyValue},attr:n,encode:function(t){if(h.isString(t))return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},decode:function(t){if(h.isString(t))return t.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}}},{"./../../common/js/utils":13}],26:[function(t,e,i){var o=t("./../../../common/js/logger"),m=t("./../../../common/js/dom"),f=t("./../../../common/js/utils"),g=t("./../../../common/js/config"),v=t("./../../../admanager/src/js/manager"),n=t("./notifier"),s=function(){this._slot=null,this._videoSlot=null,this._logger=new o,this._notifier=new n(this._logger)};s.prototype.initAd=function(t,e,i,o,n,s){var r=f.toJson(n.AdParameters);r||(this._logger.error("Failed to parse parameters JSON"),r={});var a=r.tags;a&&(a=a.startsWith("{")?a.replace(/&lt;!\[/g,"<![").replace(/]]&gt;/g,"]]>").replace(/&amp;/g,"&"):atob(a));var h=a?f.toJson(a):null,l=parseInt(r.log||window.tgx_log);isNaN(l)||(this._logger.level=l),this._logger.debug("Call: initAd: "+t+"x"+e+" / "+i+" / "+o),this._desiredBitrate=o,this._slot=s.slot,this._videoSlot=s.videoSlot,m.css(g.cdn+"/css/vast.css");var u=parseFloat(r.vRatio||"");isNaN(u)||(g.visRatio=u);var d=parseInt(r.skipTime||"");isNaN(d)&&(d=0);var c="1"==r.skipAll,p={logo:f.contains(r.opt||"","nologo"),immediateLoad:!0,skipTime:d,skipAll:c},_=this._notifier.callEvent.bind(this._notifier);this._manager=new v(_,this._logger,g,p),this._manager.init(this._slot,this._videoSlot,t,e,i,o,r.tagId,r.loadUrl,r.ref,h)},s.prototype.startAd=function(){this._logger.debug("Call: startAd"),this._manager.start()},s.prototype.stopAd=function(){this._logger.debug("Call: stopAd"),this._manager.stop()},s.prototype.handshakeVersion=function(t){return this._logger.debug("Call: handshakeVersion"),"2.0"},s.prototype.setAdVolume=function(t){this._logger.debug("Call: setAdVolume "+t),this._manager.setVolume(t)},s.prototype.getAdVolume=function(){return this._logger.debug("Call: getAdVolume"),this._manager.getVolume()},s.prototype.resizeAd=function(t,e,i){this._logger.debug("Call: resizeAd "+t+"x"+e+" "+i),this._manager.resize(t,e,i)},s.prototype.pauseAd=function(){this._logger.debug("Call: pauseAd"),this._manager.pause()},s.prototype.resumeAd=function(){this._logger.debug("Call: resumeAd"),this._manager.resume()},s.prototype.getAdExpanded=function(){return this._logger.debug("Call: getAdExpanded"),this._manager.isExpanded()},s.prototype.expandAd=function(){this._logger.debug("Call: expandAd"),this._manager.expand()},s.prototype.collapseAd=function(){this._logger.debug("Call: collapseAd"),this._manager.collapse()},s.prototype.getAdSkippableState=function(){return this._logger.debug("Call: getAdSkippableState"),this._manager.isSkippable},s.prototype.skipAd=function(){this._logger.debug("Call: skipAd"),this._manager.skip()},s.prototype.subscribe=function(t,e,i){this._notifier.subscribe(t,e,i==this?null:i)},s.prototype.unsubscribe=function(t){this._notifier.unsubscribe(t)},s.prototype.getAdWidth=function(){return this._manager.getSize().width},s.prototype.getAdHeight=function(){return this._manager.getSize().height},s.prototype.getAdDuration=function(){return this._manager.getDuration()},s.prototype.getAdRemainingTime=function(){return this._manager.getRemainingTime()},s.prototype.getAdCurrentTime=function(){return this._manager.getCurrentTime()},s.prototype.getAdCompanions=function(){return null},s.prototype.getAdIcons=function(){return this._manager.hasIcons()},s.prototype.getAdLinear=function(){return this._manager.isLinear()},window.getVPAIDAd=function(){return new s}},{"./../../../admanager/src/js/manager":3,"./../../../common/js/config":10,"./../../../common/js/dom":11,"./../../../common/js/logger":12,"./../../../common/js/utils":13,"./notifier":27}],27:[function(t,e,i){"use strict";var o=t("./../../../common/js/utils");function n(t){this._logger=t,this._eventsCallbacks={}}n.prototype.subscribe=function(t,e,i){this._logger.debug("Subscribe: "+e);var o=i?t.bind(i):t;this._eventsCallbacks[e]=o},n.prototype.unsubscribe=function(t){this._logger.debug("Unsubscribe: "+t),this._eventsCallbacks[t]=null},n.prototype.callEvent=function(e,t){if(this._logger.debug("Fire: "+e+(t?" ("+t.toString()+")":"")),e in this._eventsCallbacks){var i=this._eventsCallbacks[e];if(o.isFunction(i))try{i()}catch(t){this._logger.error("Player callback failed: "+e+" : "+(t||{}).message)}}},e.exports=n},{"./../../../common/js/utils":13}]},{},[26]);