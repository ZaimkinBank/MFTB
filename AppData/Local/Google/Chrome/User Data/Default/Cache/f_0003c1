var VpaidVideoPlayer=function(){this.videoSlot_=this.slot_=null;this.eventsCallbacks_={};this.debug_=!1;this.parameters_={};this.events_=[];this.flagSendStatus_=!1;this.attributes_={companions:[],desiredBitrate:256,duration:-1,expanded:!1,height:0,icons:"",linear:!0,remainingTime:-1,skippableState:!1,viewMode:"normal",width:0,volume:1}};VpaidVideoPlayer.prototype.handshakeVersion=function(){return"2.0"};
VpaidVideoPlayer.prototype.initAd=function(b,d,k,n,t,G){var a=this,B=null,H=!1,I=!1,J=function(c){if(!1===I){for(var e in c)if(c.hasOwnProperty(e)&&"intervention"===c[e].type){try{a.slotManager_&&(a.slotManager_.stop(),a.slotManager_.destroy()),a.runError_(2999)}catch(f){}break}I=!0}};this.sid=function(){var c=(Date.now()/1E3).toString(16).split(".").join("");c+="00000000000000".substring(0,14-c.length);return c.substring(0,8)+"-"+c.substring(8,12)+"-"+c.substring(12,14)+"xx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,
function(){return(36*Math.random()|0).toString(36)})}();this.slot_=G.slot;this.videoSlot_=G.videoSlot||null;this.videoSelf_=!1;this.containerSlot_=document.createElement("div");this.parameters_=JSON.parse(t.AdParameters);this.stopped=!1;this.siteId=this.parameters_.srtbid||0;this.placeId=this.parameters_.plid||0;this.sectionId=this.parameters_.scid||0;this.slotManagerStart_=this.slotManager_=null;null===this.videoSlot_&&(this.videoSelf_=!0,this.videoSlot_=document.createElement("video"),this.videoSlot_.setAttribute("width",
b),this.videoSlot_.setAttribute("height",d));"undefined"===typeof this.videoSlot_.muted&&(this.videoSlot_.muted=!1,this.videoSlot_.volume=0);this.attributes_.width=b;this.attributes_.height=d;this.attributes_.viewMode=k;this.attributes_.desiredBitrate=n;this.attributes_.duration=this.videoSlot_.duration;"undefined"!==typeof this.parameters_.debug&&(this.debug_=!!this.parameters_.debug);this.location="";try{this.location=top.location.href}catch(c){this.log("Can' read top.location.href")}if(""===this.location){t=
window;do{try{"undefined"!==typeof t.document.referrer&&(this.location=t.document.referrer)}catch(c){this.log("Can' read window.document.referrer");break}t&&(t=t.parent)}while(t&&t!==t.parent)}""===this.location&&(this.location=window.location.href);try{var y=location.ancestorOrigins;if(y.length){var z=y[y.length-1];z&&(z=z.replace(/\/?$/,"/"),0!==this.location.indexOf(z)&&(this.location=z))}}catch(c){}this.trackingCode_(1);if(this.siteId&&this.placeId&&this.sectionId){try{if("undefined"!==typeof ReportingObserver){var K=
new ReportingObserver(J,{buffered:!0});K.observe();window.addEventListener("unload",function(){J(K.takeRecords())})}}catch(c){}this.log("initAd "+b+"x"+d+" "+k+" "+n);this.slot_.appendChild(this.containerSlot_);this.videoSlot_.src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAu1tZGF0AAACrQYF//+p3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE1NSByMjkwMSA3ZDBmZjIyIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxOCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTMgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTEgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTI4LjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAwZYiEAD//8m+P5OXfBeLGOfKE3xkODvFZuBflHv/+VwJIta6cbpIo4ABLoKBaYTkTAAAC7m1vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAAPoAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIYdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAPoAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAACgAAAAWgAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAD6AAAAAAAAQAAAAABkG1kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAAAQAAAAEAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAATttaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAD7c3RibAAAAJdzdHNkAAAAAAAAAAEAAACHYXZjMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAACgAFoASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAADFhdmNDAWQACv/hABhnZAAKrNlCjfkhAAADAAEAAAMAAg8SJZYBAAZo6+JLIsAAAAAYc3R0cwAAAAAAAAABAAAAAQAAQAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAC5QAAAAEAAAAUc3RjbwAAAAAAAAABAAAAMAAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTguMTIuMTAw";
k=this.parameters_.counter||"";"undefined"!==typeof this.parameters_.yam&&(k+='<script type="text/javascript">(function(d,b,a){(b[a]=b[a]||[]).push(function(){try{b.yaCounter'+this.parameters_.yam+"=new Ya.Metrika({id:"+this.parameters_.yam+",clickmap:!1,trackLinks:!1,accurateTrackBounce:!0,params:"+JSON.stringify({site_id:this.siteId,srtb_domain:this.location.replace(/^(?:(?:[a-z]+:)?\/\/|\/)?([^/]+).*$/,"$1")})+'})}catch(f){}});var e=d.getElementsByTagName("script")[0],c=d.createElement("script");a=function(){e.parentNode.insertBefore(c,e)};c.type="text/javascript";c.async=!0;c.src="https://mc.yandex.ru/metrika/watch.js";"[object Opera]"==b.opera?d.addEventListener("DOMContentLoaded",a,!1):a()})(document,window,"yandex_metrika_callbacks");\x3c/script>');
if(0<k.length){var L=function(c){var e;if("SCRIPT"===c.tagName){var f=document.createElement("script");f.text=c.innerHTML;for(e=c.attributes.length-1;0<=e;e--)f.setAttribute(c.attributes[e].name,c.attributes[e].value);c.parentNode.replaceChild(f,c)}else{f=[];for(e=0;e<c.childNodes.length;e++)f.push(c.childNodes[e]);for(e=0;e<f.length;e++)L(f[e])}return c};n=document.createElement("div");n.innerHTML=k;n.style.position="absolute";n.style.width="0";n.style.height="0";this.slot_.appendChild(n);L(n)}k=
"https://imasdk.googleapis.com/js/sdkloader/ima3.js";n=0;y=document.getElementsByTagName("script");for(z=y.length;n<z;n++)if(y[n].src&&0<=y[n].src.indexOf(k)){k=!1;break}!1!==k&&(n=document.createElement("script"),n.src=k,n.type="text/javascript",document.head?document.head.appendChild(n):document.getElementsByTagName("head")[0].appendChild(n));var Q=function(){var c=[],e=[],f=function(h,p,l,g){p.addEventListener?p.addEventListener(h,g,l):p.attachEvent("on"+h,g);c.push([h,p,l,g])},q={1:"vis0",2:"vis50",
3:"vis100"},r=function(h){if("undefined"!==typeof q[h]){var p=document.createElement("img");p.alt="";p.style.cssText="width:1px;height:1px;position:fixed;left:-100px;top:-100px;opacity:0";p.src="https://www.acint.net/rtbw/1?dp=14&cd="+encodeURIComponent('{"st":'+a.siteId+',"sc":0,"pl":'+a.placeId+',"ev":"'+q[h]+'","et":"srtb","ec":0}')+"&sid="+a.sid+"&ref="+encodeURIComponent(a.location)+"&r="+Math.round((new Date).getTime()/1E3);a.slot_.appendChild(p);delete q[h]}},u={},D=function(h){h=100===h?3:
50<=h?2:0;for(var p in u)p>h&&(clearTimeout(u[p]),delete u[p]);0<h&&"undefined"===typeof u[h]&&"undefined"!==typeof q[h]&&(u[h]=setTimeout(function(l){"undefined"!==typeof q[l]&&r(l);"undefined"!==typeof q[2]&&3===l&&delete q[2];if("undefined"===typeof q[2]&&"undefined"===typeof q[3]){for(var g=0;g<c.length;g++){var w=c[g][0],x=c[g][1],v=c[g][3];x.removeEventListener?x.removeEventListener(w,v,c[g][2]):x.detachEvent("on"+w,v)}for(g=0;g<e.length;g++)e[g][0].unobserve(e[g][1])}delete u[l]},2E3,h))},
m=!1,E=function(h,p){if(h===m){if("undefined"===typeof p){for(var l=window,g=a.slot_,w=0,x=0,v=a.slot_.clientWidth,A=a.slot_.clientHeight;g;){g=g.getBoundingClientRect();var M=l.innerHeight||l.document.documentElement.clientHeight||l.document.body.clientHeight,N=l.innerWidth||l.document.documentElement.clientWidth||l.document.body.clientWidth;w+=g.top;0>w?(A=Math.min(A,Math.min(M,Math.max(0,A+w))),w=0):A=Math.max(0,Math.min(A,M-w));x+=g.left;0>x?(v=Math.min(v,Math.min(N,Math.max(0,v+g.left))),x=0):
v=Math.max(0,Math.min(v,N-x));if(l!==l.parent)g=l.frameElement,l=l.parent;else break}p=(l=v*A)?Math.round(100*l/(a.slot_.clientWidth*a.slot_.clientHeight)):0}D(p)}};if("IntersectionObserver"in window)f=function(h){var p=h/100;h=new IntersectionObserver(function(l){var g=100*l[0].intersectionRatio;g=l[0].intersectionRatio>p?Math.min(100,Math.ceil(g)):Math.max(0,Math.floor(g));setTimeout(E,0,m,g)},{threshold:p});e.push([h,a.slot_]);h.observe(a.slot_)},f(100),f(50);else try{for(var C=window;;){f("scroll",
C,!1,function(){m=(new Date).getTime()+"-"+1E4*Math.random();setTimeout(E,100,m)});if(C===C.parent)break;C=C.parent}}catch(h){}setTimeout(E,0,m);r(1)},F=function(){if(!H)if("undefined"===typeof google||0===google.ima||null===B)setTimeout(F,10);else if(!1===B)a.runError_(0);else{var c=google.ima.settings;c.setDisableCustomPlaybackForIOS10Plus(!0);c.setLocale("ru");c.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE);var e=new google.ima.AdDisplayContainer(a.containerSlot_);c=new google.ima.AdsLoader(e);
var f=new google.ima.AdsRequest,q={loaded:"AdLoaded",skip:"AdSkipped",skippableStateChanged:"AdSkippableStateChange",linearChanged:"AdLinearChange",durationChange:"AdDurationChange",expandedChanged:"AdExpandedChange",volumeChange:"AdVolumeChange",impression:"AdImpression",start:"AdVideoStart",firstQuartile:"AdVideoFirstQuartile",midpoint:"AdVideoMidpoint",thirdQuartile:"AdVideoThirdQuartile",complete:"AdVideoComplete",click:"AdClickThru",interaction:"AdInteraction",userClose:"AdUserClose",pause:"AdPaused",
resume:"AdPlaying",log:"AdLog",allAdsCompleted:"AdStopped"};c.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(r){if(!0!==a.slotManager_){var u=new google.ima.AdsRenderingSettings;if(u.restoreCustomPlaybackStateOnAdBreakComplete&&a.slotManager_)try{a.slotManager_.destroy()}catch(m){a.log(m)}a.slotManager_=r.getAdsManager({currentTime:0},u);for(var D in google.ima.AdEvent.Type)if(google.ima.AdEvent.Type.hasOwnProperty(D))switch(r=google.ima.AdEvent.Type[D],r){case "start":a.slotManager_.addEventListener(r,
function(m){if(m=m.getAd())a.attributes_.duration!==m.getDuration()&&(a.attributes_.duration=m.getDuration(),a.callEvent_("AdDurationChange")),a.attributes_.linear=m.isLinear(),a.callEvent_("AdVideoStart"),a.trackingCode_(2)});try{setTimeout(Q,100)}catch(m){a.log(m)}break;case "durationChange":case "adProgress":a.slotManager_.addEventListener(r,function(m){(m=m.getAdData())&&a.attributes_.duration!==m.duration&&(a.attributes_.duration=m.duration,a.callEvent_("AdDurationChange"))});break;default:q[r]&&
a.slotManager_.addEventListener(r,function(m){a.callEvent_(q[m.type])})}e.initialize();try{a.slotManager_.init(a.attributes_.width,a.attributes_.height,a.attributes_.viewMode),a.slotManager_.setVolume(a.videoSlot_.volume||0),a.runManager_(),a.runEvent_()}catch(m){a.log(m)}}});c.addEventListener("adError",function(r){a.runError_(r.getError?r.getError().getErrorCode():0)});f.adsResponse=B;f.linearAdSlotWidth=a.attributes_.width;f.linearAdSlotHeight=a.attributes_.height;f.setAdWillAutoPlay(!0);f.setAdWillPlayMuted(a.videoSlot_.muted);
c.requestAds(f);H=!0}},O=function(){var c=function(q){return 10>q?"0"+q:""+q},e=(new Date).getTimezoneOffset();c=(0<e?"-":"+")+c(Math.floor(Math.abs(e)/60))+":"+c(Math.abs(e)%60);var f=new XMLHttpRequest;f.open("GET","https://ssp-rtb.sape.ru/data/?callback=sapeRTBreadResponse_"+a.siteId+"&srtbid="+a.siteId+"&scids="+a.sectionId+"&sx="+b+"&sy="+d+"&u="+encodeURIComponent(a.location)+"&allimps=1&fl=0&tz="+encodeURIComponent(c)+"&op=vast");f.withCredentials=!0;f.onload=function(){B=200===f.status?f.responseText||
'<VAST version="3.0"/>':!1;F()};f.onerror=function(){B=!1};f.send()};try{var P=this.videoSlot_.play();"undefined"===typeof P?(this.videoSlot_.pause(),F()):P.then(function(){a.videoSlot_.pause();O()})["catch"](function(){a.videoSelf_?(a.videoSlot_.volume=0,a.videoSlot_.muted=!0,a.videoSlot_.play().then(function(){a.videoSlot_.pause();O()})["catch"](function(){a.videoSlot_.pause();a.videoSlot_.volume=1;a.videoSlot_.muted=!1;a.runError_(0)})):a.runError_(0)})}catch(c){this.runError_(0)}}else this.runError_(0)};
VpaidVideoPlayer.prototype.trackingCode_=function(b){if(2===b||3===b){if(!1!==this.flagSendStatus_)return;this.flagSendStatus_=!0}this.trackingPixel_("https://www.acint.net/pxl/"+b+"?dp=16&id="+this.siteId+"."+this.placeId+"."+this.sectionId+"&sid="+this.sid+"&ref="+encodeURIComponent(this.location)+"&r="+Math.round((new Date).getTime()/1E3))};
VpaidVideoPlayer.prototype.trackingPixel_=function(b){var d=document.createElement("img");d.alt="";d.src=b;d.style.width="1px";d.style.height="1px";d.style.position="fixed";d.style.left="-100px";d.style.top="-100px";d.style.opacity="0";this.slot_.appendChild(d)};VpaidVideoPlayer.prototype.runManager_=function(){null===this.slotManagerStart_&&(this.slotManagerStart_=!0,this.slotManager_.start())};
VpaidVideoPlayer.prototype.runError_=function(b){1009!==b&&901!==b&&(this.callEvent_("AdError",b),this.trackingCode_(5),0!==b&&this.trackingPixel_("https://www.acint.net/rtbw/1?dp=14&cd="+encodeURIComponent('{"st":'+this.siteId+',"sc":'+this.sectionId+',"pl":'+this.placeId+',"ev":"adError","et":"ima","ec":'+b+"}")+"&sid="+this.sid+"&ref="+encodeURIComponent(this.location)+"&r="+Math.round((new Date).getTime()/1E3)));this.stopAd()};
VpaidVideoPlayer.prototype.runEvent_=function(b,d){if(!this.stopped||"AdStopped"===b)if(this.slotManager_)if("undefined"===typeof b){var k=this;k.events_.length&&k.events_.forEach(function(n){n[1].call(k,n[0],k.slotManager_)})}else d.call(this,b,this.slotManager_);else"undefined"!==typeof b&&this.events_.push([b,d])};VpaidVideoPlayer.prototype.startAd=function(){this.log("Starting ad");this.runEvent_("AdStarted",function(){this.runManager_();this.callEvent_("AdStarted")})};
VpaidVideoPlayer.prototype.stopAd=function(){null===this.slotManager_&&(this.slotManager_=!0);this.log("Stopping ad");this.trackingCode_(3);this.stopped=!0;this.runEvent_("AdStopped",function(){this.callEvent_("AdStopped");this.slotManager_&&!0!==this.slotManager_&&(this.slotManager_.stop(),this.slotManager_.destroy());for(var b in this.eventsCallbacks_)this.eventsCallbacks_.hasOwnProperty(b)&&this.unsubscribe(b)})};
VpaidVideoPlayer.prototype.resizeAd=function(b,d,k){this.log("resizeAd "+b+"x"+d+" "+k);this.runEvent_("AdSizeChange",function(n,t){this.attributes_.width=b;this.attributes_.height=d;this.attributes_.viewMode=k;this.slot_.setAttribute("width",this.attributes_.width);this.slot_.setAttribute("height",this.attributes_.height);t.resize(b,d,k);this.callEvent_("AdSizeChange")})};VpaidVideoPlayer.prototype.pauseAd=function(){this.log("pauseAd");this.runEvent_("AdPaused",function(b,d){d.pause()})};
VpaidVideoPlayer.prototype.resumeAd=function(){this.log("resumeAd");this.runEvent_("AdPlaying",function(b,d){d.resume()})};VpaidVideoPlayer.prototype.expandAd=function(){this.log("expandAd");this.runEvent_("AdExpanded",function(b,d){this.attributes_.expanded=!0;d.expand()})};VpaidVideoPlayer.prototype.collapseAd=function(){this.log("collapseAd");this.attributes_.expanded=!1};
VpaidVideoPlayer.prototype.skipAd=function(){this.log("skipAd");this.runEvent_("AdSkipped",function(b,d){d.getAdSkippableState()&&d.skip()})};VpaidVideoPlayer.prototype.subscribe=function(b,d,k){this.log("Subscribe "+d);this.eventsCallbacks_[d]=b.bind(k)};VpaidVideoPlayer.prototype.unsubscribe=function(b){this.log("unsubscribe "+b);this.eventsCallbacks_[b]=null};VpaidVideoPlayer.prototype.getAdLinear=function(){this.log("getAdLinear");return this.attributes_.linear};
VpaidVideoPlayer.prototype.getAdWidth=function(){this.log("getAdWidth");return this.attributes_.width};VpaidVideoPlayer.prototype.getAdHeight=function(){this.log("getAdHeight");return this.attributes_.height};VpaidVideoPlayer.prototype.getAdExpanded=function(){this.log("getAdExpanded");return this.attributes_.expanded};VpaidVideoPlayer.prototype.getAdSkippableState=function(){this.log("getAdSkippableState");return this.slotManager_?this.slotManager_.getAdSkippableState():!1};
VpaidVideoPlayer.prototype.getAdRemainingTime=function(){this.log("getAdRemainingTime");return this.slotManager_?this.slotManager_.getRemainingTime():-1};VpaidVideoPlayer.prototype.getAdDuration=function(){this.log("getAdDuration");return this.attributes_.duration};VpaidVideoPlayer.prototype.getAdVolume=function(){this.log("getAdVolume");return this.slotManager_?this.slotManager_.getVolume()||0:0};
VpaidVideoPlayer.prototype.setAdVolume=function(b){this.log("setAdVolume "+b);this.runEvent_("AdVolumeChange",function(d,k){k.setVolume(b||0)})};VpaidVideoPlayer.prototype.getAdCompanions=function(){this.log("getAdCompanions");return this.attributes_.companions};VpaidVideoPlayer.prototype.getAdIcons=function(){this.log("getAdIcons");return this.attributes_.icons};VpaidVideoPlayer.prototype.log=function(b){this.debug_&&console.log("[vpaid-ssp]",b)};
VpaidVideoPlayer.prototype.callEvent_=function(b,d){b in this.eventsCallbacks_?null!==this.eventsCallbacks_[b]&&("undefined"!==typeof d?(this.log(b+" ("+d+")"),this.eventsCallbacks_[b](d)):(this.log(b),this.eventsCallbacks_[b]())):this.log("Miss event: "+b)};var getVPAIDAd=function(){return new VpaidVideoPlayer};